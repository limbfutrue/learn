#### 理解JVM内存区域

##### 运行时数据区

抽象概念：内部实现依赖寄存器、高速缓存、主内存。

计算器 = 指令+数据；

虚拟机栈、本地方法栈、程序计数器----指令相关；

方法区、堆-----数据相关；

##### 程序计数器

当前线程执行的字节码的行号指示器，各个线程之间独立存储，互不影响（较小的内存空间）。

##### 虚拟机栈

虚拟机栈是每个线程私有的，线程在运行时，执行每个方法时都会打包成一个栈帧，栈帧中存储了局部变量表、操作数栈、动态链接，返回地址等信息，然后放入栈。每个方法就是一个栈帧。每个方法的执行就对应着栈帧在虚拟机栈中的入栈和出栈过程。

栈的大小缺省为1M。可以修改。

###### 局部变量表

局部变量的表，用来存放局部变量的。

###### 操作数栈

存放我们方法执行的操作数的，它就是一个栈，先进后出的栈结构，操作数栈就是用来操作的，操作的元素可以是java中的任意类型，所以我们知道，在方法刚刚开始的时候，这个方法的操作数栈是空的，操作数栈运行方法会一直运行入栈、出栈操作的。

###### 动态链接

java语言特性多态（需要类加载、运行时才能确定具体的方法），动态特性（Groovy、js、动态代理）。

###### 返回地址

正常返回（调用程序计数器中的地址作为返回）、异常的话（通过异常处理器表<非栈帧中的>来确定）。

##### 本地方法栈

各虚拟机自由实现

##### 线程共享的区域

###### 方法区/永久代

用来存储已经被虚拟机加载的类信息、常量、静态变量等数据。

###### 堆

几乎所有的对象都存储在这里。也是垃圾回收发生的主要区域。

###### 直接内存

不是虚拟机运行时数据区的一部分，也不是java虚拟机规范中定义的内存区域；如果使用了NIO,这块区域会被频繁使用，在java堆内可以用directByteBuffer对象直接引用并操作；这块内存不受java堆大小限制，但受本机总内存的限制，可以通过-XX:MaxDirectMemorySize来设置（默认与堆内存最大值一样），所以也会出现OOM异常。



